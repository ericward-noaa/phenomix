<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Including covariates • phenomix</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Including covariates">
<meta property="og:description" content="phenomix">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">phenomix</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/a1_examples.html">Fitting time varying phenology models with the phenomix package</a>
    </li>
    <li>
      <a href="../articles/a2_covariates.html">Including covariates</a>
    </li>
    <li>
      <a href="../articles/a3_troubleshooting.html">Troubleshooting</a>
    </li>
    <li>
      <a href="../articles/a4_derived.html">Extracting estimated and derived parameters</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ericward-noaa/phenomix/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Including covariates</h1>
            
            <h4 data-toc-skip class="date">2023-05-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ericward-noaa/phenomix/blob/HEAD/vignettes/a2_covariates.Rmd" class="external-link"><code>vignettes/a2_covariates.Rmd</code></a></small>
      <div class="hidden name"><code>a2_covariates.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ericward-noaa.github.io/phenomix" class="external-link">phenomix</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/kaskr/adcomp/wiki" class="external-link">TMB</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="covariates">Covariates<a class="anchor" aria-label="anchor" href="#covariates"></a>
</h2>
<p>Covariates may be included in <code>phenomix</code> models in several
ways. First, we allow them to affect the mean,</p>
<p><span class="math display">\[\mu = \mathbf{X}\mathbf{B} +
\mathbf{Z}\mathbf{\alpha}\]</span></p>
<p>where fixed effect covariates <span class="math inline">\(\mathbf{X}\)</span> are linked to the mean via
coefficients <span class="math inline">\(\mathbf{B}\)</span> and random
effects <span class="math inline">\(\mathbf{\alpha}\)</span> are linked
to the mean via design matrix <span class="math inline">\(\mathbf{Z}\)</span>. For simplicity, we only
assume that the random effects are IID in time, e.g. <span class="math inline">\(\mu_{\delta} \sim Normal(0,\sigma_{\mu})\)</span>.
The random effects are optional of course, and may be turned on / off
with the <code>est_mu_re</code> argument.</p>
<p>Fixed effects for the mean at minimum include a global intercept, but
may include any other covariates via the formula interface. The formula
is included as an argument to the <code><a href="../reference/fit.html">fit()</a></code> function, and
defaults to <code>mu ~ 1</code>, or an intercept only model. Including
temperature could be done as <code>mu ~ temp</code>, which also includes
an intercept.</p>
<p>Importantly, if covariates are to be included in the mean or standard
deviation, a second data frame <code>covar_data</code> must be included
that has a unique covariate value for each time slice of data
(e.g. year). For example, in the example above with temperature, covar
data would have to look something like this:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># temp is a dummy variable here representing annual deviations in temperature, </span></span>
<span><span class="co"># but you could replace it here with your own data</span></span>
<span><span class="va">covar_data</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fl">2000</span><span class="op">:</span><span class="fl">2020</span>, </span>
<span>                        temp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">21</span>,mean<span class="op">=</span><span class="fl">0</span>,sd<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Similarly, we could include a linear trend in the mean
<code>mu ~ nyear</code>, where nyear is a numeric version of year. One
way to pass in the data would be simply making <code>nyear</code>
redundant with <code>year</code>,</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">covar_data</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fl">2000</span><span class="op">:</span><span class="fl">2020</span><span class="op">)</span></span>
<span><span class="va">covar_data</span><span class="op">$</span><span class="va">nyear</span> <span class="op">&lt;-</span> <span class="va">covar_data</span><span class="op">$</span><span class="va">year</span></span></code></pre></div>
<p>However, we’ve found that approach can be slightly unstable. Instead,
we can center or scale the numeric year variable. Here, we’ll scale it
to start at 1.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">covar_data</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fl">2000</span><span class="op">:</span><span class="fl">2020</span><span class="op">)</span></span>
<span><span class="va">covar_data</span><span class="op">$</span><span class="va">nyear</span> <span class="op">&lt;-</span> <span class="va">covar_data</span><span class="op">$</span><span class="va">year</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">covar_data</span><span class="op">$</span><span class="va">year</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span></span></code></pre></div>
<p>In addition to the mean, we allow covariates to affect the standard
deviation. The overall approach is exactly as above with the mean,
however a couple points are worth highlighting:</p>
<ul>
<li>With the mean, we did not use a link function. With the standard
deviation(s) we assume the covariate effects are estimated in log-space,
to keep standard deviations positive.</li>
</ul>
<p><span class="math display">\[log(\sigma_{1}) = \mathbf{X}\mathbf{B} +
\mathbf{Z}\mathbf{\alpha}\]</span> * For asymmetric models, we assume
that the same covariates act on both the left and right sides of the
peak (in other words, we do not allow separate formulas for each
side)</p>
<ul>
<li><p>The relationship between covariates and the variances is
specified through a separate formula, <code>sigma ~ 1</code></p></li>
<li><p>For asymmetric models, we estimate different coefficients on each
side. So for a model with <code>sigma~temp</code> we could
estimate</p></li>
<li><p>Random effects in the standard deviation are turned on/off with
the <code>est_sigma_re</code> argument in
<code><a href="../reference/create_data.html">create_data()</a></code></p></li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Eric J. Ward.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
